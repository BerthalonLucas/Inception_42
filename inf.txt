==========================================
INCEPTION PROJECT OVERVIEW
==========================================

📁 STRUCTURE DU PROJET
==========================================
.
├── get_inf.sh
├── .git
│   ├── branches
│   ├── COMMIT_EDITMSG
│   ├── config
│   ├── description
│   ├── HEAD
│   ├── hooks
│   │   ├── applypatch-msg.sample
│   │   ├── commit-msg.sample
│   │   ├── fsmonitor-watchman.sample
│   │   ├── post-update.sample
│   │   ├── pre-applypatch.sample
│   │   ├── pre-commit.sample
│   │   ├── pre-merge-commit.sample
│   │   ├── prepare-commit-msg.sample
│   │   ├── pre-push.sample
│   │   ├── pre-rebase.sample
│   │   ├── pre-receive.sample
│   │   ├── push-to-checkout.sample
│   │   └── update.sample
│   ├── index
│   ├── info
│   │   └── exclude
│   ├── logs
│   │   ├── HEAD
│   │   └── refs
│   │       ├── heads
│   │       └── remotes
│   ├── objects
│   │   ├── 05
│   │   │   └── f25bb51f544c77a8fbe9de978523ae08bb4d9d
│   │   ├── 07
│   │   │   └── 167baacea7e9fa1c5c1a3a232496d10490406e
│   │   ├── 09
│   │   │   └── e3ec372d1ab82f56159965ff4c87e7269b507e
│   │   ├── 10
│   │   │   └── 608c07d23c9ac10b87d91b3bc5a84b2e0159d9
│   │   ├── 11
│   │   │   └── d571a122167ed616fd0853ee5727b156a8306a
│   │   ├── 12
│   │   │   └── 13f55f5d451ce79090e1bafcd1b512bc4adbba
│   │   ├── 18
│   │   │   └── 47b1a5c7fa034ea7a7897a9416fa5a7a694f03
│   │   ├── 1a
│   │   │   └── 8c21d70617c5d292c15a178c90fd6c0e5f621b
│   │   ├── 22
│   │   │   └── 1c1508cf2db3d04e8f5eb4c55b1660904c5697
│   │   ├── 26
│   │   │   └── 55cff0172b0f77c6b52c3dc5970991bd35068c
│   │   ├── 2e
│   │   │   ├── 920647df4c1b9f32afe3fa3149d5723447a5cf
│   │   │   └── ec77e470dd3871a5290207bf632fde379fd932
│   │   ├── 2f
│   │   │   └── d613201b5bd7b98721cc74b733f240b5e75f85
│   │   ├── 3d
│   │   │   └── 1a71418000f1a733cb4a69443125287a346ee2
│   │   ├── 4a
│   │   │   ├── 80ad5ec0d7907c9472b055c6617056fcf609a5
│   │   │   └── 9c5b7a594c49acd18c10563f990ae6c4a4fe4e
│   │   ├── 52
│   │   │   └── 5a63b687e351d3af13bf72e8996bbe72717feb
│   │   ├── 54
│   │   │   └── 676a6fd9ccd1a5b046c4233115de1240b8af43
│   │   ├── 57
│   │   │   └── ae379da84a46e2a2ff698b2dd2388bebde32e6
│   │   ├── 58
│   │   │   └── 70c5d6863cbc814259b7b9df787b3a1954e604
│   │   ├── 5c
│   │   │   └── 768dd4f796fa054a800dc2baa4cfba897c66d4
│   │   ├── 5e
│   │   │   └── 2f3014e19a790da45289bb9cbca30ef0147ec5
│   │   ├── 61
│   │   │   └── 2662cd2ac3c03700c2b043e7e521311f6836d1
│   │   ├── 66
│   │   │   └── 01448ecff77d5947a5b77ca50ba97a3777d4e5
│   │   ├── 67
│   │   │   └── b9d170d7f8e6526940ac6843f84a41ba38ffa1
│   │   ├── 68
│   │   │   └── a4d68c295407820c32c122f455038820f2703d
│   │   ├── 6d
│   │   │   └── 5fa35b95f87852d08890b48b054ce02e1f90ed
│   │   ├── 73
│   │   │   └── a584adc19cca77b9eae754d71ce352257cf531
│   │   ├── 75
│   │   │   ├── 88b5977739c8ee3944e07c92626c2c4cb0600e
│   │   │   └── a3ab1f35ff14e5ac0d80100b703a559eef470c
│   │   ├── 78
│   │   │   └── 929ac1884f010e33aaacafd3720f2267a84f07
│   │   ├── 7f
│   │   │   └── 5760e8b13050745997ed62eea93d61252cb449
│   │   ├── 84
│   │   │   └── 890b2fb20de1180fc41394e53ba93bc887e00a
│   │   ├── 85
│   │   │   └── 2006335056bd7a0bf8b198b00aebbd8b84318c
│   │   ├── 88
│   │   │   └── 0290d2ab5e4767a59a7be93f40e24ab9fcbba3
│   │   ├── 89
│   │   │   └── 81970587e6821a824aa9fca50f4be90c0d44ae
│   │   ├── 8a
│   │   │   └── 2474492c8f03fcf420c5289e6eb7b5feac19f0
│   │   ├── 8c
│   │   │   └── 23a38112390122244f02e41a5c1ff334c8b88c
│   │   ├── 8d
│   │   │   └── 3a030d1b9a70e18b7ac3b8c719479bf0523f92
│   │   ├── 9e
│   │   │   └── de10f21ef1c4076154afe345ee6c26b026ce86
│   │   ├── a4
│   │   │   └── 71698fe2e0248cd007784adf569a2b02ffb71f
│   │   ├── a5
│   │   │   └── 1998ab2efe90c9b02a7e9e40e0c7dd6b94326c
│   │   ├── a9
│   │   │   └── 4af59e342e422cfd99d0dce7a456a6ef53dacd
│   │   ├── af
│   │   │   └── c3727b179ef4603a3d02890f768105cb6ed7f9
│   │   ├── b3
│   │   │   └── d06d77bd982fce815d94b924923bde55c67a0c
│   │   ├── bd
│   │   │   └── d6bd365d9939eb3815c8d9a177520262187991
│   │   ├── be
│   │   │   └── c48615309db8c35ce5de055c6719a5b1285c23
│   │   ├── c1
│   │   │   └── 0831d9d00ba913cda1ced5227339220ef54a2b
│   │   ├── cb
│   │   │   └── f5693ee884c42110983955a7a167e4fe4c91b1
│   │   ├── d4
│   │   │   └── 0932084e4a7d00a5cfd214a8641b20e03fe821
│   │   ├── d7
│   │   │   ├── a5e44e2eb9f23fdef41c4d4b6940797600a867
│   │   │   └── c10f6b447312ac6306c98951600cf5b1869319
│   │   ├── d9
│   │   │   └── d502c17e771250c7777895ef815882ebed1e8f
│   │   ├── e6
│   │   │   └── 9de29bb2d1d6434b8b29ae775ad8c2e48c5391
│   │   ├── e7
│   │   │   └── 34a4f648d11712159ca0b561618f7fe368eefe
│   │   ├── e8
│   │   │   └── d8b48e4b901412f0908c2daad0e0a6ef2f41f2
│   │   ├── ef
│   │   │   └── 54da4176ddd88226b4014f0a0402c3842c0645
│   │   ├── f3
│   │   │   └── 03e98eb74227cfaa0f26e59b0a09d65667c8e9
│   │   ├── f5
│   │   │   └── 4115ebe23b64228221ad381d45d0ef111607a8
│   │   ├── f7
│   │   │   └── 48fb4cc3ec0f2a541ae50898509adf9d1077e9
│   │   ├── fb
│   │   │   └── 1cb2fc01088760334a758abdd849c01985a4bc
│   │   ├── fd
│   │   │   └── 3e046a56da617051c3ff2b343bf75ed6914631
│   │   ├── info
│   │   └── pack
│   └── refs
│       ├── heads
│       │   └── main
│       ├── remotes
│       │   └── origin
│       └── tags
├── inf.txt
├── Makefile
├── secrets
├── srcs
│   ├── compose.yml
│   ├── .env
│   └── requirements
│       ├── mariadb
│       │   ├── conf
│       │   ├── Dockerfile
│       │   └── tools
│       ├── nginx
│       │   ├── conf
│       │   ├── Dockerfile
│       │   └── tools
│       └── wordpress
│           ├── conf
│           ├── Dockerfile
│           └── tools
├── subject_Inception.md
└── tests
    ├── compose.yml
    └── Dockerfile

87 directories, 94 files

==========================================
📄 CONTENU DES FICHIERS
==========================================

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 Makefile
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

all: build

build:
	cd srcs && docker-compose up --build -d

reload:
	cd srcs && docker-compose down && docker-compose up --build -d

stop:
	cd srcs && docker-compose down

clean:
	cd srcs && docker-compose down --rmi all --volumes --remove-orphans
	docker system prune -f
	docker volume prune -f
	docker network prune -f
	docker image prune -f
	docker container prune -f

re: clean all

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/compose.yml
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
services:
  nginx:
    build: ./requirements/nginx
    ports:
      - "1234:443"
    restart: unless-stopped
    volumes:
      - wordpress_files:/var/www/html
    depends_on:
      - wordpress
    networks:
      - inception
  
  wordpress:
    build: ./requirements/wordpress
    restart: unless-stopped
    environment:
      WORDPRESS_DB_HOST: ${WORDPRESS_DB_HOST}
      WORDPRESS_DB_USER: ${WORDPRESS_DB_USER}
      WORDPRESS_DB_PASSWORD: ${WORDPRESS_DB_PASSWORD}
      WORDPRESS_DB_NAME: ${WORDPRESS_DB_NAME}
      WP_TITLE: ${WP_TITLE}
      WP_URL: ${WP_URL}
      WP_ADMIN_USER: ${WP_ADMIN_USER}
      WP_ADMIN_PASSWORD: ${WP_ADMIN_PASSWORD}
      WP_ADMIN_EMAIL: ${WP_ADMIN_EMAIL}
      WP_USER: ${WP_USER}
      WP_USER_PASSWORD: ${WP_USER_PASSWORD}
      WP_USER_EMAIL: ${WP_USER_EMAIL}
    volumes:
      - wordpress_files:/var/www/html
      - db_data:/var/lib/mysql
    depends_on:
      - maria-db
    networks:
      - inception

  maria-db:
    build: ./requirements/mariadb
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - inception

networks:
  inception:
    driver: bridge

volumes:
  wordpress_files:
  db_data:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/.env
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
MYSQL_ROOT_PASSWORD=root_password
MYSQL_DATABASE=wordpress_db
MYSQL_USER=wordpress_user
MYSQL_PASSWORD=wordpress_password
WORDPRESS_DB_HOST=maria-db:3306
WORDPRESS_DB_NAME=wordpress_db
WORDPRESS_DB_USER=wordpress_user
WORDPRESS_DB_PASSWORD=wordpress_password

WP_TITLE="Inception Blog"
WP_URL="https://lberthal.42.fr"
WP_ADMIN_USER="lberthal"
WP_ADMIN_PASSWORD="SecureAdminPass123!"
WP_ADMIN_EMAIL="lberthal@student.42.fr"
WP_USER="regular_user"
WP_USER_PASSWORD="UserPass123!"
WP_USER_EMAIL="user@student.42.fr"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/requirements/nginx/Dockerfile
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
FROM alpine:3.22.1

RUN apk update  && apk upgrade

RUN apk add openssl nginx curl
# todo add -y to add commands

RUN mkdir certs

RUN openssl req -x509 -nodes -out /certs/inception.crt -keyout /certs/inception.key -subj "/C=FR/ST=IDF/L=Paris/O=42/OU=42/CN=lberthal.42.fr/UID=lberthal"

COPY ./conf/nginx.conf /etc/nginx/nginx.conf

RUN chmod 600 /certs/inception.key \
    && chmod 644 /certs/inception.crt

CMD ["nginx", "-g", "daemon off;"]


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/requirements/nginx/conf/nginx.conf
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
events {
    worker_connections 2048;
}

http {
        
    error_log /var/log/nginx/error.log debug;
    access_log /var/log/nginx/access.log;

    server {
        listen       443 ssl;
        server_name  lberthal.42.fr;
        ssl_certificate     /certs/inception.crt;
        ssl_certificate_key /certs/inception.key;
        ssl_protocols       TLSv1.2 TLSv1.3;
        ssl_ciphers         HIGH:!aNULL:!MD5;
        
        root /var/www/html/wordpress;
        index index.php index.html;
        
        location ~ \.php$ {
            fastcgi_pass wordpress:9000;
            fastcgi_index index.php;
            include fastcgi_params;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            fastcgi_param PATH_INFO $fastcgi_path_info;
        }
    }
}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/requirements/nginx/tools/entrypoint.sh
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/requirements/mariadb/Dockerfile
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
FROM alpine:3.22.1

RUN apk update && apk upgrade

RUN apk add mariadb mariadb-client

RUN mariadb-install-db --user=mysql --datadir=/var/lib/mysql

COPY ./tools/entrypoint.sh /entrypoint.sh

RUN chmod +x /entrypoint.sh

COPY ./conf/my.cnf /etc/my.cnf.d/zzz-custom.cnf

CMD ["sh", "-c", "/entrypoint.sh"]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/requirements/mariadb/conf/my.cnf
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[mysqld]

skip-networking = 0
bind-address = 0.0.0.0
port = 3306

max_connections = 100

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/requirements/mariadb/tools/entrypoint.sh
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#!/bin/sh
set -e

mkdir -p /run/mysqld
chown -R mysql:mysql /run/mysqld

mysqld --user=mysql --datadir=/var/lib/mysql --bootstrap << EOF
USE mysql;
FLUSH PRIVILEGES;

DELETE FROM mysql.user WHERE User='';

CREATE DATABASE IF NOT EXISTS \`${MYSQL_DATABASE}\`;
CREATE USER IF NOT EXISTS '${MYSQL_USER}'@'%' IDENTIFIED BY '${MYSQL_PASSWORD}';
GRANT ALL PRIVILEGES ON \`${MYSQL_DATABASE}\`.* TO '${MYSQL_USER}'@'%';

ALTER USER 'root'@'localhost' IDENTIFIED BY '${MYSQL_ROOT_PASSWORD}';

FLUSH PRIVILEGES;
EOF

echo "Database and users created successfully"

exec mysqld --user=mysql --datadir=/var/lib/mysql --bind-address=0.0.0.0

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/requirements/wordpress/Dockerfile
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
FROM alpine:3.22.1

RUN apk update && apk upgrade && \
    apk add php php-fpm php-mysqli php-json php-curl php-dom php-exif \
            php-fileinfo php-mbstring php-openssl php-xml php-zip \
            wget curl mariadb-client

RUN mkdir -p /var/www/html && wget https://wordpress.org/latest.tar.gz && \
    tar -xzf latest.tar.gz && \
    mv wordpress /var/www/html && \
    rm latest.tar.gz

COPY tools/setup.sh /setup.sh

RUN chmod +x /setup.sh

RUN curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar

RUN chmod +x wp-cli.phar && mv wp-cli.phar /usr/local/bin/wp

RUN sed -i 's/listen = 127.0.0.1:9000/listen = 9000/g' /etc/php*/php-fpm.d/www.conf

CMD ["/setup.sh"]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📄 srcs/requirements/wordpress/tools/setup.sh
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#!/bin/sh


echo "Waiting for Mariadb..."
until mariadb -h maria-db -u ${WORDPRESS_DB_USER} -p${WORDPRESS_DB_PASSWORD} -e "SELECT 1" &>/dev/null; do
    sleep 2
done
echo "Mariadb ready!"

cd /var/www/html/wordpress

echo "testing install wp cli install"

# if [wp --infos &>/dev/null]; then
#     echo "wp cli installed"
# else
#     echo "wp cli not installed"
#     exit 1
# fi

wp config create \
    --dbname=${WORDPRESS_DB_NAME} \
    --dbuser=${WORDPRESS_DB_USER} \
    --dbpass=${WORDPRESS_DB_PASSWORD} \
    --dbhost=${WORDPRESS_DB_HOST} \
    --allow-root

wp core install \
    --url=${WP_URL} \
    --title="${WP_TITLE}" \
    --admin_user=${WP_ADMIN_USER} \
    --admin_password=${WP_ADMIN_PASSWORD} \
    --admin_email=${WP_ADMIN_EMAIL} \
    --skip-email \
    --allow-root

wp user create ${WP_USER} ${WP_USER_EMAIL} \
    --role=author \
    --user_pass=${WP_USER_PASSWORD} \
    --allow-root

echo "WordPress installation complete!"

exec /usr/sbin/php-fpm* -F

==========================================
✅ FIN DU RAPPORT
==========================================
